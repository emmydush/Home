<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worker Profile - Household Workers Platform</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <div class="container">
            <div class="logo">
                <h1>Household<span>Workers</span></h1>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="#" id="logout-link">Logout</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Worker Profile -->
    <section class="worker-profile">
        <div class="container">
            <div class="profile-header">
                <div class="profile-image">
                    <img src="https://via.placeholder.com/150" alt="Worker Photo" id="worker-photo">
                </div>
                <div class="profile-info">
                    <h1 id="worker-name">Loading...</h1>
                    <p class="worker-title" id="worker-title">Loading...</p>
                    <div class="worker-rating">
                        <span class="stars" id="worker-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                        <span class="rating-value" id="worker-rating">0.0</span>
                        <span class="review-count" id="review-count">(0 reviews)</span>
                    </div>
                    <p class="worker-location">üìç <span id="worker-location">Loading...</span></p>
                    <button class="btn btn-primary" id="book-now-btn">Book Now</button>
                </div>
            </div>

            <div class="profile-content">
                <div class="profile-main">
                    <div class="profile-section">
                        <h2>About Me</h2>
                        <p id="worker-bio">Loading worker information...</p>
                    </div>

                    <div class="profile-section">
                        <h2>Skills & Services</h2>
                        <div class="skills-list" id="skills-list">
                            <!-- Skills will be populated here -->
                        </div>
                    </div>

                    <div class="profile-section">
                        <h2>Availability</h2>
                        <div class="availability-calendar">
                            <div class="calendar-header">
                                <button class="btn btn-outline" id="prev-month">‚Äπ</button>
                                <h3 id="calendar-month">Loading...</h3>
                                <button class="btn btn-outline" id="next-month">‚Ä∫</button>
                            </div>
                            <div class="calendar-grid" id="calendar-grid">
                                <!-- Calendar days will be populated here -->
                            </div>
                        </div>
                    </div>

                    <div class="profile-section">
                        <h2>Pricing</h2>
                        <div class="pricing-options">
                            <div class="pricing-card">
                                <h3>Standard Service</h3>
                                <p class="price">$<span id="hourly-rate">0</span><span>/hour</span></p>
                                <ul>
                                    <li>Basic cleaning tasks</li>
                                    <li>Vacuuming and mopping</li>
                                    <li>Bathroom and kitchen cleaning</li>
                                </ul>
                                <button class="btn btn-outline" onclick="selectService('standard')">Select Plan</button>
                            </div>
                            <div class="pricing-card">
                                <h3>Premium Service</h3>
                                <p class="price">$<span id="premium-rate">0</span><span>/hour</span></p>
                                <ul>
                                    <li>Deep cleaning</li>
                                    <li>Inside appliances</li>
                                    <li>Baseboards and fixtures</li>
                                </ul>
                                <button class="btn btn-primary" onclick="selectService('premium')">Select Plan</button>
                            </div>
                        </div>
                    </div>

                    <div class="profile-section">
                        <h2>Reviews</h2>
                        <div class="reviews-list" id="reviews-list">
                            <p>Loading reviews...</p>
                        </div>
                        <button class="btn btn-outline" id="load-more-reviews" style="display: none; margin-top: 1rem;">Load More Reviews</button>
                    </div>
                </div>

                <div class="profile-sidebar">
                    <div class="sidebar-card">
                        <h3>Contact Worker</h3>
                        <form id="contact-form">
                            <div class="form-group">
                                <label for="contact-name">Your Name</label>
                                <input type="text" id="contact-name" name="contact-name" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="contact-email">Email</label>
                                <input type="email" id="contact-email" name="contact-email" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="contact-message">Message</label>
                                <textarea id="contact-message" name="contact-message" class="form-control" rows="4" required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Send Message</button>
                        </form>
                    </div>

                    <div class="sidebar-card">
                        <h3>Verification</h3>
                        <div class="verification-status">
                            <div class="verification-item" id="id-verification">
                                <span class="status-icon">‚úó</span>
                                <span>ID Verification</span>
                            </div>
                            <div class="verification-item" id="background-check">
                                <span class="status-icon">‚úó</span>
                                <span>Background Check</span>
                            </div>
                            <div class="verification-item" id="insurance">
                                <span class="status-icon">‚úó</span>
                                <span>Insurance</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Booking Modal -->
    <div class="modal" id="booking-modal">
        <div class="modal-content booking-modal-content">
            <div class="modal-header">
                <h2>Book Service with <span id="worker-modal-name">Worker</span></h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="booking-form" class="booking-form">
                    <div class="form-group">
                        <label for="booking-service">Service Type</label>
                        <select id="booking-service" name="service_type" class="form-control" required>
                            <option value="">Select service</option>
                            <option value="cleaning">House Cleaning</option>
                            <option value="childcare">Childcare</option>
                            <option value="cooking">Cooking</option>
                            <option value="maintenance">Maintenance</option>
                            <option value="gardening">Gardening</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="booking-date">Date</label>
                        <input type="date" id="booking-date" name="date" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="booking-time">Time</label>
                        <input type="time" id="booking-time" name="time" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="booking-duration">Duration (hours)</label>
                        <input type="number" id="booking-duration" name="duration" class="form-control" min="1" max="8" value="2" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="booking-notes">Special Notes</label>
                        <textarea id="booking-notes" name="notes" class="form-control" rows="3" placeholder="Any special requirements or instructions"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Estimated Cost: <span class="estimated-cost">$<span id="estimated-cost">0.00</span></span></label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline close-modal-btn">Cancel</button>
                <button class="btn btn-primary" id="submit-booking-btn">Confirm Booking</button>
            </div>
        </div>
    </div>

    <!-- Success Dialog Box -->
    <div class="dialog-box" id="success-dialog">
        <button class="dialog-close">&times;</button>
        <div class="dialog-header">
            <span class="dialog-icon">‚úì</span>
            <h3 class="dialog-title">Success</h3>
        </div>
        <div class="dialog-content" id="success-dialog-content">
            Operation completed successfully!
        </div>
        <div class="dialog-footer">
            <button class="btn-dialog btn-dialog-primary" id="success-dialog-close">OK</button>
        </div>
    </div>

    <!-- Error Dialog Box -->
    <div class="dialog-box error" id="error-dialog">
        <button class="dialog-close">&times;</button>
        <div class="dialog-header">
            <span class="dialog-icon">‚úó</span>
            <h3 class="dialog-title">Error</h3>
        </div>
        <div class="dialog-content" id="error-dialog-content">
            An error occurred. Please try again.
        </div>
        <div class="dialog-footer">
            <button class="btn-dialog btn-dialog-secondary" id="error-dialog-close">OK</button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2023 HouseholdWorkers. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="js/api.js"></script>
    <script src="js/main.js"></script>
    <script>
        // Worker profile functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Get worker ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const workerId = urlParams.get('id');
            const shouldBook = urlParams.get('book') === 'true';
            
            if (!workerId) {
                showErrorDialog('No worker ID specified');
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 2000);
                return;
            }
            
            // Load worker data
            loadWorkerData(workerId);
            
            // Contact form submission
            const contactForm = document.getElementById('contact-form');
            if (contactForm) {
                contactForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    showSuccessDialog('Message sent successfully! The worker will contact you soon.');
                    contactForm.reset();
                });
            }
            
            // Book now button
            const bookButton = document.getElementById('book-now-btn');
            if (bookButton) {
                bookButton.addEventListener('click', function() {
                    openModal('booking-modal');
                });
            }
            
            // Booking form submission
            const bookingForm = document.getElementById('booking-form');
            const submitBookingBtn = document.getElementById('submit-booking-btn');
            const hourlyRateElement = document.getElementById('hourly-rate');
            
            if (bookingForm && submitBookingBtn) {
                // Update estimated cost when duration changes
                const durationInput = document.getElementById('booking-duration');
                durationInput.addEventListener('input', function() {
                    const hourlyRate = parseFloat(hourlyRateElement.textContent) || 0;
                    const duration = parseFloat(this.value) || 0;
                    const estimatedCost = hourlyRate * duration;
                    document.getElementById('estimated-cost').textContent = estimatedCost.toFixed(2);
                });
                
                submitBookingBtn.addEventListener('click', function() {
                    // In a real app, this would submit the booking to the server
                    showSuccessDialog('Booking request submitted successfully! The worker will confirm your appointment soon.');
                    closeModal('booking-modal');
                    bookingForm.reset();
                });
            }
            
            // Modal functionality
            const modals = document.querySelectorAll('.modal');
            const closeModalButtons = document.querySelectorAll('.close-modal, .close-modal-btn');
            
            // Open modal function
            window.openModal = function(modalId) {
                document.getElementById(modalId).classList.add('active');
                document.body.style.overflow = 'hidden';
            };
            
            // Close modal function
            window.closeModal = function(modalId) {
                document.getElementById(modalId).classList.remove('active');
                document.body.style.overflow = 'auto';
            };
            
            // Close modals when clicking outside
            modals.forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                        document.body.style.overflow = 'auto';
                    }
                });
            });
            
            // Close modal buttons
            closeModalButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    if (modal) {
                        modal.classList.remove('active');
                        document.body.style.overflow = 'auto';
                    }
                });
            });
            
            // Service selection
            window.selectService = function(serviceType) {
                const serviceSelect = document.getElementById('booking-service');
                if (serviceType === 'standard') {
                    serviceSelect.value = 'cleaning';
                } else {
                    serviceSelect.value = 'cleaning'; // Default to cleaning for premium
                }
                openModal('booking-modal');
            };
            
            // Dialog box functionality
            const successDialog = document.getElementById('success-dialog');
            const errorDialog = document.getElementById('error-dialog');
            const successDialogClose = document.getElementById('success-dialog-close');
            const errorDialogClose = document.getElementById('error-dialog-close');
            const successDialogCloseBtn = successDialog.querySelector('.dialog-close');
            const errorDialogCloseBtn = errorDialog.querySelector('.dialog-close');
            
            // Close dialog functions
            window.closeSuccessDialog = function() {
                successDialog.classList.remove('show');
            };
            
            window.closeErrorDialog = function() {
                errorDialog.classList.remove('show');
            };
            
            // Event listeners for dialog close buttons
            successDialogClose.addEventListener('click', closeSuccessDialog);
            errorDialogClose.addEventListener('click', closeErrorDialog);
            successDialogCloseBtn.addEventListener('click', closeSuccessDialog);
            errorDialogCloseBtn.addEventListener('click', closeErrorDialog);
            
            // Close dialogs when clicking outside content
            successDialog.addEventListener('click', function(e) {
                if (e.target === successDialog) {
                    closeSuccessDialog();
                }
            });
            
            errorDialog.addEventListener('click', function(e) {
                if (e.target === errorDialog) {
                    closeErrorDialog();
                }
            });
        });
        
        // Show success dialog function
        function showSuccessDialog(message) {
            const successDialog = document.getElementById('success-dialog');
            const successDialogContent = document.getElementById('success-dialog-content');
            successDialogContent.textContent = message;
            successDialog.classList.add('show');
            
            // Auto close after 5 seconds
            setTimeout(() => {
                closeSuccessDialog();
            }, 5000);
        }
        
        // Show error dialog function
        function showErrorDialog(message) {
            const errorDialog = document.getElementById('error-dialog');
            const errorDialogContent = document.getElementById('error-dialog-content');
            errorDialogContent.textContent = message;
            errorDialog.classList.add('show');
            
            // Auto close after 5 seconds
            setTimeout(() => {
                closeErrorDialog();
            }, 5000);
        }
        
        async function loadWorkerData(workerId) {
            try {
                // Fetch worker data from API
                const response = await api.getWorker(workerId);
                
                if (response.success && response.worker) {
                    const worker = response.worker;
                    
                    // Update profile header
                    document.getElementById('worker-name').textContent = worker.name || 'Unknown';
                    document.getElementById('worker-modal-name').textContent = worker.name || 'Worker';
                    document.getElementById('worker-title').textContent = worker.service_categories && worker.service_categories.length > 0 
                        ? worker.service_categories.join(', ') 
                        : 'Professional Service Provider';
                    
                    // Update rating
                    const rating = parseFloat(worker.rating) || 0;
                    const fullStars = Math.floor(rating);
                    const halfStar = rating % 1 >= 0.5 ? 1 : 0;
                    const emptyStars = 5 - fullStars - halfStar;
                    
                    let starsHtml = '‚òÖ'.repeat(fullStars);
                    if (halfStar) starsHtml += '‚òÜ';
                    starsHtml += '‚òÜ'.repeat(emptyStars);
                    
                    document.getElementById('worker-stars').innerHTML = starsHtml;
                    document.getElementById('worker-rating').textContent = rating.toFixed(1);
                    document.getElementById('review-count').textContent = `(0 reviews)`; // Would need separate API call for actual reviews
                    
                    // Update location
                    document.getElementById('worker-location').textContent = 'New York, NY'; // Would come from address data
                    
                    // Update bio
                    document.getElementById('worker-bio').textContent = worker.bio || 'No bio available.';
                    
                    // Update skills
                    const skillsList = document.getElementById('skills-list');
                    if (worker.skills && worker.skills.length > 0) {
                        try {
                            const skills = typeof worker.skills === 'string' 
                                ? JSON.parse(worker.skills) 
                                : worker.skills;
                            skillsList.innerHTML = skills.map(skill => 
                                `<span class="skill-tag">${skill}</span>`
                            ).join('');
                        } catch (e) {
                            skillsList.innerHTML = `<span class="skill-tag">${worker.skills}</span>`;
                        }
                    } else {
                        skillsList.innerHTML = '<p>No skills listed.</p>';
                    }
                    
                    // Update pricing
                    const hourlyRate = parseFloat(worker.hourly_rate) || 25;
                    document.getElementById('hourly-rate').textContent = hourlyRate.toFixed(2);
                    document.getElementById('premium-rate').textContent = (hourlyRate * 1.4).toFixed(2);
                    
                    // Update calendar (simplified for demo)
                    const now = new Date();
                    const monthNames = ["January", "February", "March", "April", "May", "June",
                                      "July", "August", "September", "October", "November", "December"];
                    document.getElementById('calendar-month').textContent = `${monthNames[now.getMonth()]} ${now.getFullYear()}`;
                    
                    // Generate sample calendar days
                    const calendarGrid = document.getElementById('calendar-grid');
                    calendarGrid.innerHTML = '';
                    for (let i = 1; i <= 30; i++) {
                        const dayElement = document.createElement('div');
                        dayElement.className = 'calendar-day ' + (i % 3 === 0 ? 'available' : 'booked');
                        dayElement.textContent = `${i < 10 ? '0' : ''}${i}`;
                        calendarGrid.appendChild(dayElement);
                    }
                    
                    // Update verification status
                    const idVerification = document.getElementById('id-verification');
                    const backgroundCheck = document.getElementById('background-check');
                    const insurance = document.getElementById('insurance');
                    
                    // For demo purposes, show all as verified
                    idVerification.className = 'verification-item verified';
                    idVerification.innerHTML = '<span class="status-icon">‚úì</span><span>ID Verified</span>';
                    
                    backgroundCheck.className = 'verification-item verified';
                    backgroundCheck.innerHTML = '<span class="status-icon">‚úì</span><span>Background Check</span>';
                    
                    insurance.className = 'verification-item verified';
                    insurance.innerHTML = '<span class="status-icon">‚úì</span><span>Insurance</span>';
                    
                    // Update reviews (simplified for demo)
                    const reviewsList = document.getElementById('reviews-list');
                    reviewsList.innerHTML = `
                        <div class="review-card">
                            <div class="review-header">
                                <div class="reviewer-info">
                                    <strong>Michael T.</strong>
                                    <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                                </div>
                                <div class="review-date">May 15, 2023</div>
                            </div>
                            <p class="review-text">Excellent service! Highly recommend.</p>
                        </div>
                        <div class="review-card">
                            <div class="review-header">
                                <div class="reviewer-info">
                                    <strong>Sarah K.</strong>
                                    <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                                </div>
                                <div class="review-date">May 3, 2023</div>
                            </div>
                            <p class="review-text">Very professional and detail-oriented.</p>
                        </div>
                    `;
                    
                    // If book parameter is true, automatically open booking modal after loading data
                    const urlParams = new URLSearchParams(window.location.search);
                    const shouldBook = urlParams.get('book') === 'true';
                    if (shouldBook) {
                        // Wait a bit for data to load before opening modal
                        setTimeout(function() {
                            openModal('booking-modal');
                        }, 1000);
                    }
                } else {
                    showErrorDialog('Worker not found');
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 2000);
                }
            } catch (error) {
                console.error('Error loading worker data:', error);
                showErrorDialog('Error loading worker data. Please try again.');
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 2000);
            }
        }
    </script>
</body>
</html>